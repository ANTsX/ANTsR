language: c

compiler:
- clang

os:
- linux
- osx

before_install:
- cd ..
- basedir=${PWD}
- curl -OL http://raw.github.com/craigcitro/r-travis/master/scripts/travis-tool.sh
- chmod 755 ./travis-tool.sh
- mkdir -p ~/.R
- export CC=clang
- export CXX=clang++
- echo "CC=clang" >  ~/.R/Makevars
- echo "CXX=clang++" >> ~/.R/Makevars
- source ~/.R/Makevars

install:
- ./travis-tool.sh bootstrap
- ./travis-tool.sh install_r    BGLR
- ./travis-tool.sh install_r    caret
- ./travis-tool.sh install_r    cluster
- ./travis-tool.sh install_r    DMwR
- ./travis-tool.sh install_r    e1071
- ./travis-tool.sh install_r    fastICA
- ./travis-tool.sh install_r    fpc
- ./travis-tool.sh install_r    grid
- ./travis-tool.sh install_r    glmnet
- ./travis-tool.sh install_r    igraph
- ./travis-tool.sh install_r    magic
- ./travis-tool.sh install_r    misc3d
- ./travis-tool.sh install_r    moments
- ./travis-tool.sh install_r    pixmap
- ./travis-tool.sh install_r    png
- ./travis-tool.sh install_r    psych
- ./travis-tool.sh install_r    randomForest
- ./travis-tool.sh install_r    rgl
- ./travis-tool.sh install_r    robust
- ./travis-tool.sh install_r    signal
- ./travis-tool.sh install_r    visreg
- ./travis-tool.sh install_r    Rcpp
- ./travis-tool.sh install_r    knitr
- ./travis-tool.sh install_r    rmarkdown
- cd ${basedir}

script:
- travis_wait 40 R CMD build ANTsR
# - R CMD INSTALL --build ANTsR_1.0.tar.gz
- R CMD  check ANTsR_1.0.tar.gz --no-install --no-manual --as-cran
- Rscript -e 'library(ANTsR);  fi<-antsImageRead( getANTsRData("r16") ,2); mi<-antsImageRead( getANTsRData("r64"),2)' -e 'antsRegistration(fixed=fi , moving=mi, typeofTransform = c("SyN"))'
- cd ANTsR

before_deploy: git fetch --tags

# deploy:
#  provider: releases
#  api_key:
#    secure: KeamoMlOUTB1Oi1VrBIbRaDCzHdrVqfSKXYc06zqi6FBkdXIsaNmX2P50CyOAlEBpkXATUMX2S8CAqwa37XSEF3WwSpRDTGEWgwas0N3D1PRSPN8HJYZ2hKWjcchZF1ov9ERRMOtJshlQ+W6YddPQiHRVCx2/8VAjNqxgT+1sQI=
#  file: ../ANTsR_1.0.tgz
#  on:
#    repo: stnava/ANTsR

after_failure:
- ./travis-tool.sh dump_logs

notifications:
  email:
    recipients:
    - stnava@gmail.com
    on_success: change
    on_failure: always

env:
  global:
  - R_BUILD_ARGS=" "
  - R_CHECK_ARGS=" --timings"
  - R_CHECK_TIME="TRUE"
  - R_CHECK_TESTS="TRUE"
  - _R_CHECK_TIMINGS_="0"
