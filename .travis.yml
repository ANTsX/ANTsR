language: c
compiler:
- clang
os:
- linux
- osx
before_install:
- cd ..
- basedir=${PWD}
- curl -OL http://raw.github.com/craigcitro/r-travis/master/scripts/travis-tool.sh
- chmod 755 ./travis-tool.sh
- ./travis-tool.sh bootstrap
- mkdir -p ~/.R
- export CC=clang
- export CXX=clang++
- echo "CC=clang" >  ~/.R/Makevars
- echo "CXX=clang++" >> ~/.R/Makevars
- source ~/.R/Makevars
install:
- ./travis-tool.sh install_github RcppCore/Rcpp
- cd ${basedir}
script:
- travis_retry R CMD build ANTsR &&  R CMD INSTALL --build ANTsR_1.0.tar.gz && R CMD
  check ANTsR_1.0.tar.gz --no-install --no-manual --as-cran && Rscript -e 'library(ANTsR);
  fi<-antsImageRead( getANTsRData("r16") ,2); mi<-antsImageRead( getANTsRData("r64")
  ,2)' -e 'antsRegistration(fixed=fi , moving=mi ,typeofTransform = c("SyN"))'

deploy:
  provider: releases
  api_key:
    secure: KeamoMlOUTB1Oi1VrBIbRaDCzHdrVqfSKXYc06zqi6FBkdXIsaNmX2P50CyOAlEBpkXATUMX2S8CAqwa37XSEF3WwSpRDTGEWgwas0N3D1PRSPN8HJYZ2hKWjcchZF1ov9ERRMOtJshlQ+W6YddPQiHRVCx2/8VAjNqxgT+1sQI=
  file: ANTsR_1.0.tgz
  on:
    repo: stnava/ANTsR

after_failure:
- ./travis-tool.sh dump_logs

notifications:
  email:
    recipients:
    - stnava@gmail.com
    on_success: change
    on_failure: always

env:
  global:
  - R_BUILD_ARGS="--no-build-vignettes "
  - R_CHECK_ARGS="--no-build-vignettes --timings"
  - R_CHECK_TIME="TRUE"
  - R_CHECK_TESTS="TRUE"
  - _R_CHECK_TIMINGS_="0"
