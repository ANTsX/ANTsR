<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Transformations and statistical representations for images in R • ANTsR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Transformations and statistical representations for images in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ANTsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ANTsR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MultiChannel.html">Multichannel image proccessing</a>
    </li>
    <li>
      <a href="../articles/RestingBOLD.html">Resting BOLD (basic analyses using ANTsR)</a>
    </li>
    <li>
      <a href="../articles/antsrTransform.html">Using the antsrTransform class</a>
    </li>
    <li>
      <a href="../articles/deformationSimulation.html">Simulate a deformation field with ANTsR</a>
    </li>
    <li>
      <a href="../articles/iMath.html">iMath (mathematical operations inside ANTsR)</a>
    </li>
    <li>
      <a href="../articles/multivarTemplateCoordinates.html">multivariate template coordinates example for eigenanatomy</a>
    </li>
    <li>
      <a href="../articles/rfLesionSeg.html">Multi-resolution voxel-wise neighborhood random forest (MRV-NRF) lesion segmentation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Transformations and statistical representations for images in R</h1>
                        <h4 class="author">Brian B. Avants</h4>
            
            <h4 class="date">2019-05-06</h4>
      
      
      <div class="hidden name"><code>ANTsR.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“A small leak will sink a great ship.” (folk wisdom)</p>
</blockquote>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The ANTs<em>R</em> package interfaces state of the art image processing with <em>R</em> statistical methods. The project grew out of the need, at University of Pennsylvania, to develop large-scale analytics pipelines that track provenance from scanner to scientific study. ANTs<em>R</em> achieves this by wrapping an ANTs and ITK C++ core via <code>Rcpp</code> <span class="citation">(Eddelbuettel 2013)</span>.</p>
<p><a href="http://www.itk.org/">ITK</a> is a templated C++ framework with I/O and support for arbitrary image types (usually 2, 3 or 4 dimensions) as well as surface representations. <a href="http://stnava.github.io/ANTs">ANTs</a>, built on ITK, focuses on multivariate image matching and segmentation as well as geometric (even high-dimensional) image transformation. Both tools are <a href="http://journal.frontiersin.org/ResearchTopic/1580">deeply validated and widely used</a>.</p>
<p>Together, these tools allow powerful image manipulations. However, they lack a true statistical back-end. Historically, statistical software was not amenable to direct manipulation of multiple dimensional images. This led to “in-house” statistical programming or, perhaps worse (for science), reliance on closed source commercial software. Given the increasing <a href="http://r4stats.com/articles/popularity/">popularity of <em>R</em></a> and prominence of quantitative imaging, it is natural that <em>R</em> should have a package focused on biological or medical image analysis.</p>
<p>This package integrates several frameworks for extracting quantitative information from images and mapping images into reference coordinate systems. Human brain mapping studies have long relied on Talairach-Tournoux and related coordinate systems <span class="citation">(TALAIRACH and TOURNOUX 1958)</span>. Similar standardized localization is becoming more common within non-human studies <span class="citation">(Johnson et al. 2010; Majka et al. 2013)</span>. Atlases of other organ systems are also emerging and being applied clinically <span class="citation">(de Marvao et al. 2014)</span>. This class of methods relies on <em>image transformation</em> and <em>image segmentation</em> as an aid to the ultimate goal of quantifying variability within and across populations. Longer term, such methods will be critical to individualized patient care and other translational applications.</p>
<div id="antsr-algorithms" class="section level2">
<h2 class="hasAnchor">
<a href="#antsr-algorithms" class="anchor"></a>ANTs<em>R</em> Algorithms</h2>
<p>Here, we provide an overview of the methods available within ANTs<em>R</em>.</p>
<ul>
<li><p>core image processing and I/O: ITK <span class="citation">(B. B. Avants, Tustison, et al. 2014)</span>;</p></li>
<li><p>registration and utilities for image processing: ANTs mappings <span class="citation">(Tustison, Cook, et al. 2014)</span> and feature extraction <span class="citation">(Tustison, Shrinidhi, et al. 2014)</span>;</p></li>
<li><p>dimensionality reduction: Eigenanatomy <span class="citation">(Dhillon et al. 2014)</span> and SCCAN <span class="citation">(B. B. Avants, Libon, et al. 2014)</span>;</p></li>
<li><p>methods for ASL-based cerebral blood flow quantification <span class="citation">(Kandel et al. 2015)</span>;</p></li>
<li><p>neighborhood representations of images that enable rich statistical models <span class="citation">(Kandel et al. 2015)</span></p></li>
<li><p>core statistics and temporal filtering via <em>R</em> packages that is amenable to BOLD image processing</p></li>
</ul>
<p>In combination, these tools enable one to go from near-raw medical imaging data to a fully reproducible scientific publication <span class="citation">(Avants 2015)</span>.</p>
</div>
<div id="data-organization-and-access-in-antsr" class="section level2">
<h2 class="hasAnchor">
<a href="#data-organization-and-access-in-antsr" class="anchor"></a>Data organization and access in ANTs<em>R</em>
</h2>
<p>This package uses an <code>antsImage</code> S4 class to hold pointers to ITK images. We convert <code>antsImage</code> objects to <em>R</em> objects before passing them to <em>R</em> statistical methods. E.g. we convert a <em>scalar</em> image to a vector, a collection of scalar images to a matrix or a time series image to a matrix. Currently, ANTs<em>R</em> does not explicitly represent images with vector valued voxels (e.g. tensor or warp images) although these may be supported in the future in a way that is similar to our current support for time series images. The large majority of images employed within ANTs<em>R</em> are of 2, 3 or 4 dimensions with <code>float</code> pixel types. This information is stored within the <code>antsImage</code> class.<br>
A few example images are built into ANTs<em>R</em>, but more can be downloaded. See <code>?getANTsRData</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">img&lt;-<span class="kw">antsImageRead</span>( <span class="kw">getANTsRData</span>(<span class="st">"r16"</span>), <span class="dv">2</span> ) <span class="co"># built in image</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">img</a></code></pre></div>
<pre><code>## antsImage
##   Pixel Type          : float 
##   Components Per Pixel: 1 
##   Dimensions          : 256x256 
##   Voxel Spacing       : 1x1 
##   Origin              : 0 0 
##   Direction           : 1 0 0 1 
##   Filename           : /Library/Frameworks/R.framework/Versions/3.6/Resources/library/ANTsRCore/extdata/r16slice.jpg</code></pre>
<p>Take a quick look at the image.</p>
<p><img src="ANTsR_files/figure-html/basic_plot-1.png" width="700"></p>
</div>
<div id="contributions-of-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#contributions-of-the-package" class="anchor"></a>Contributions of the package</h2>
<p>ANTs<em>R</em> includes:</p>
<ul>
<li><p>An organizational system such that relatively small scripts may implement full studies</p></li>
<li>Implementation of foundational methods
<ul>
<li>Smoothing, temporal filtering, etc</li>
<li>functional image denoising via <code>compcor</code> and <code>*DenoiseR</code>
</li>
<li>flexible: easy to estimate voxel-wise statistical models</li>
</ul>
</li>
<li><p>Reference simulation data and examples distributed with the package</p></li>
<li>Interpretation of results
<ul>
<li>sparse low-dimensional predictors</li>
<li>anatomical labeling of predictors based on AAL and other coordinate systems</li>
</ul>
</li>
<li><p>Openness and reproducibility</p></li>
</ul>
<p>In total, ANTs<em>R</em> is a rigorous framework upon which one may build customized statistical implementations appropriate for large-scale functional, structural or combined functional and structural image analyses. Because much of the core is implemented with C++, the framework also remains efficient. Finally, note that <code>Rscript</code> allows one to send ANTs<em>R</em> scripts to clusters and take advantage of distributed computing resources.</p>
</div>
<div id="basic-antsr-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-antsr-functionality" class="anchor"></a>Basic ANTs<em>R</em> functionality</h2>
<p>Here, we quickly summarize ANTsR functionality and useful tools.</p>
<p><strong>The travis build system</strong></p>
<p>We test ANTs<em>R</em> regularly. The status of the build (and an expected build result) can be seen here: <a href="https://travis-ci.org/stnava/ANTsR"><img src="https://travis-ci.org/stnava/ANTsR.png?branch=master" alt="Build Status"></a>. Take a look at the detailed log to see what one might expect if building ANTs<em>R</em> from source.</p>
<p><strong>Image input and output</strong></p>
<p>If nothing else, ANTs<em>R</em> makes it easy to read and write (medical) images and to map them into a format compatible with <em>R</em>. Formats we frequently use include jpg, tiff, mha, nii.gz and nrrd. However, only the last three have a proper physical space representation necessary for mapping. Below is an example of how we access this type of image and see its geometry. Check <code>antsImageWrite</code> for the primary supported I/O.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mnifilename&lt;-<span class="kw">getANTsRData</span>(<span class="st">"r27"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">img&lt;-<span class="kw">antsImageRead</span>(mnifilename, <span class="dt">pixeltype=</span><span class="st">"unsigned char"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">img</a></code></pre></div>
<pre><code>## antsImage
##   Pixel Type          : unsigned char 
##   Components Per Pixel: 1 
##   Dimensions          : 256x256 
##   Voxel Spacing       : 1x1 
##   Origin              : 0 0 
##   Direction           : 1 0 0 1 
##   Filename           : /Library/Frameworks/R.framework/Versions/3.6/Resources/library/ANTsRCore/extdata/r27slice.jpg</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">retval&lt;-<span class="kw">antsImageWrite</span>(img,mnifilename)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">antsGetSpacing</span>(img)</a></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">antsGetDirection</span>(img)</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    0
## [2,]    0    1</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">antsGetOrigin</span>(img)</a></code></pre></div>
<pre><code>## [1] 0 0</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(img[<span class="dv">120</span>,<span class="dv">122</span>]) <span class="co"># same type of thing in 3 or 4D</span></a></code></pre></div>
<pre><code>##      [,1]
## [1,]  182</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(img))</a></code></pre></div>
<pre><code>## [1] 255</code></pre>
<p><strong>Index an image with a label</strong></p>
<p>Often, you would like to summarize or extract information from within a known region of an image with arbitrary shape but within a given intensity “zone”. We simulate this below and show a few accessors and type conversions.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">gaussimg&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">array</a></span>( <span class="dt">data=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">125</span>), <span class="dt">dim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>) )</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">arrayimg&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">array</a></span>( <span class="dt">data=</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">125</span>), <span class="dt">dim=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>) )</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">img&lt;-<span class="kw">as.antsImage</span>( arrayimg )</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(img) )</a></code></pre></div>
<pre><code>## [1] 125</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(img[ img <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>  ]))</a></code></pre></div>
<pre><code>## [1] 88</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(img[ img <span class="op">&gt;=</span><span class="st"> </span><span class="dv">50</span> <span class="op">&amp;</span><span class="st"> </span>img <span class="op">&lt;=</span><span class="st"> </span><span class="dv">99</span>  ]))</a></code></pre></div>
<pre><code>## [1] 99</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># if using SUBSET using an antsImage, you must be explicit</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">sub =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">as.array</a></span>(img <span class="op">&gt;=</span><span class="st"> </span><span class="dv">50</span> <span class="op">&amp;</span><span class="st"> </span>img <span class="op">&lt;=</span><span class="st"> </span><span class="dv">99</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>( gaussimg[ sub  ]) )</a></code></pre></div>
<pre><code>## [1] -0.2068316</code></pre>
<p><strong>Convert a 4D image to a matrix</strong></p>
<p>Four dimensional images are generated and used in the same way. One can easily transform from 4D image to matrix and back.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">gaussimg&lt;-<span class="kw">makeImage</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">10</span>), <span class="dt">voxval =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">125</span><span class="op">*</span><span class="dv">10</span>)  )</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(gaussimg))</a></code></pre></div>
<pre><code>## [1]  5  5  5 10</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">avg3d&lt;-ANTsR<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ANTsR/topics/getAverageOfTimeSeries">getAverageOfTimeSeries</a></span>( gaussimg )</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">mask &lt;-<span class="st"> </span>avg3d <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3">gmat&lt;-<span class="kw"><a href="../reference/timeseries2matrix.html">timeseries2matrix</a></span>( gaussimg, mask )</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(gmat))</a></code></pre></div>
<pre><code>## [1] 10 95</code></pre>
<p>If one has a mask, then one can use <code>makeImage</code> to generate a new image from a scalar or vector.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">newimg&lt;-<span class="kw">makeImage</span>( mask, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(avg3d) )    <span class="co"># from scalar</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">newimg&lt;-<span class="kw">makeImage</span>( mask, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">colMeans</a></span>(gmat) ) <span class="co"># from vector</span></a></code></pre></div>
<p><strong>Convert a list of images to a matrix</strong></p>
<p>Often, one has several scalar images that need to be accumulated for statistical processing. Here, we generate a simulated set of these images and then proceed to smooth them, store them in a list and convert them to a matrix after extracting the information of each image within a data-driven mask.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">nimages&lt;-<span class="dv">100</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">ilist&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>()</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nimages )</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  {</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  simimg&lt;-<span class="kw">makeImage</span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">50</span>,<span class="dv">50</span>) , <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">2500</span>) )</a>
<a class="sourceLine" id="cb28-6" data-line-number="6">  simimg&lt;-<span class="kw">smoothImage</span>(simimg,<span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  ilist[[ i  ]] =<span class="st"> </span>simimg</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="co"># get a mask from the first image</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">mask&lt;-<span class="kw">getMask</span>( ilist[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">  <span class="dt">lowThresh=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ilist[[<span class="dv">1</span>]]), <span class="dt">cleanup=</span><span class="ot">TRUE</span> )</a>
<a class="sourceLine" id="cb28-12" data-line-number="12">mat&lt;-<span class="kw">imageListToMatrix</span>( ilist, mask )</a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(mat))</a></code></pre></div>
<pre><code>## [1] 100 231</code></pre>
<p>Once we have a matrix representation of our population, we might run a quick voxel-wise regression within the mask. Then we look at some summary statistics.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">mat&lt;-<span class="kw">imageListToMatrix</span>( ilist, mask )</a>
<a class="sourceLine" id="cb30-2" data-line-number="2">age&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(mat) ) <span class="co"># simulated age</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3">gender&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>( <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"F"</span>,<span class="st">"M"</span>), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(mat)<span class="op">/</span><span class="dv">2</span> ) <span class="co"># simulated gender</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co"># this creates "real" but noisy effects to detect</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">mat&lt;-mat<span class="op">*</span>(age<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(mat)))</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">mdl&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>( mat <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>gender )</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">mdli&lt;-<span class="kw">bigLMStats</span>( mdl, <span class="dv">1</span>.e<span class="dv">-4</span> )</a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(mdli))</a></code></pre></div>
<pre><code>## [1] "fstat"      "pval.model" "beta"       "beta.std"   "beta.t"    
## [6] "beta.pval"</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(mdli<span class="op">$</span>beta.t))</a></code></pre></div>
<pre><code>## [1] "age"     "genderM"</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"age"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/p.adjust">p.adjust</a></span>(mdli<span class="op">$</span>beta.pval[<span class="dv">1</span>,]))))</a></code></pre></div>
<pre><code>## [1] "age 0.00254183222665977"</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"gen"</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">min</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/p.adjust">p.adjust</a></span>(mdli<span class="op">$</span>beta.pval[<span class="dv">2</span>,]))))</a></code></pre></div>
<pre><code>## [1] "gen 0.27839912216445"</code></pre>
<p><strong>Write out a statistical map</strong></p>
<p>We might also write out the images so that we can save them for later or look at them with other software.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">agebetas&lt;-<span class="kw">makeImage</span>( mask , mdli<span class="op">$</span>beta.t[<span class="dv">1</span>,] )</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">returnval&lt;-<span class="kw">antsImageWrite</span>( agebetas, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="dt">fileext =</span><span class="st">'.nii.gz'</span>) )</a></code></pre></div>
</div>
<div id="more-antsr-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#more-antsr-functionality" class="anchor"></a>More ANTs<em>R</em> functionality</h2>
<p>We achieve quantification in biological or medical imaging by using prior knowledge about the image content.</p>
<p><strong>Segmentation</strong></p>
<p>In segmentation, we assume the image has a known set of tissues, organs etc. Here, we assume 3 tissues exist and use a classic k-means model with MRF penalty <span class="citation">(Avants et al. 2011)</span>. Note that we also bias correct the image to help it match our model <span class="citation">(Tustison et al. 2010)</span>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">fi&lt;-<span class="kw">antsImageRead</span>( <span class="kw">getANTsRData</span>(<span class="st">"r16"</span>) ,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">fi&lt;-<span class="kw">n3BiasFieldCorrection</span>(fi,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">seg&lt;-<span class="kw">kmeansSegmentation</span>( fi, <span class="dv">3</span> )</a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(seg<span class="op">$</span>segmentation))</a></code></pre></div>
<p><img src="ANTsR_files/figure-html/segmentation-1.png" width="700"></p>
<p>If you like segmentation, also look at <code>rfSegmentation</code> and <code>atropos</code>.</p>
<p><strong>Registration</strong></p>
<p>In registration, we assume the image can be mapped to some canonical shape or example, i.e. an atlas. Or to another individual. ANTs<em>R</em> provides a simple wrapper for SyN image registration <span class="citation">(Tustison and Avants 2013)</span>,</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">mi&lt;-<span class="kw">antsImageRead</span>( <span class="kw">getANTsRData</span>(<span class="st">"r64"</span>) ,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">mytx&lt;-<span class="kw">antsRegistration</span>(<span class="dt">fixed=</span>fi , <span class="dt">moving=</span>mi ,</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="dt">typeofTransform =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'SyN'</span>))</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">regresult&lt;-<span class="kw">iMath</span>(mytx<span class="op">$</span>warpedmovout,<span class="st">"Normalize"</span>)</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">fiedge&lt;-<span class="kw">iMath</span>(fi,<span class="st">"Canny"</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb40-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(regresult, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(fiedge), <span class="dt">window.overlay=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>,<span class="dv">1</span>)) )</a></code></pre></div>
<p><img src="ANTsR_files/figure-html/syn-1.png" width="700"></p>
<p>while <code>invariantImageSimilarity</code> provides powerful multi-start search for lower dimensional affine registrations.</p>
<p>Deformable image registration results in a voxel-wise map of the contraction and expansion of the moving image (after affine transformation) that is needed to map to the fixed image. This deformation gradient is colloquially known as “the jacobian”.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">jac&lt;-<span class="kw"><a href="../reference/createJacobianDeterminantImage.html">createJacobianDeterminantImage</a></span>(fi,mytx<span class="op">$</span>fwdtransforms[[<span class="dv">1</span>]],<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(jac))</a></code></pre></div>
<p><img src="ANTsR_files/figure-html/jacobian-1.png" width="700"></p>
<p>Above, we compute and plot the image of the log-jacobian. This mapping is a useful summary measurement for morphometry <span class="citation">(Avants et al. 2012,<span class="citation">@Kim2008</span>)</span>.</p>
<p><strong>Registration and segmentation</strong></p>
<p>Registration and segmentation are often applied jointly or iteratively to maximize some criterion. See the example in <code>jointIntensityFusion</code> for one such case <span class="citation">(Wang and Yushkevich 2013)</span>.</p>
<p><strong>Neighborhood operations</strong></p>
<p>Basic I/O and management of images as vectors is critical. However, there is additional information that can be gained by representing an image and its neighborhood information. ANTs<em>R</em> represents image neighborhoods, which capture shape and texture, as a matrix. Here, extract an image neighborhood matrix representation such that we may analyze it at a given scale.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">mnit&lt;-<span class="kw">getANTsRData</span>(<span class="st">"r16"</span>)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">mnit&lt;-<span class="kw">antsImageRead</span>( mnit )</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">mnit &lt;-<span class="st"> </span><span class="kw">resampleImage</span>( mnit , <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">4</span>, mnit<span class="op">@</span>dimension) ) <span class="co"># downsample</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4">mask2&lt;-<span class="kw">getMask</span>(mnit,<span class="dt">lowThresh=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(mnit),<span class="dt">cleanup=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">radius &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">2</span>,mnit<span class="op">@</span>dimension)</a>
<a class="sourceLine" id="cb42-6" data-line-number="6">mat2&lt;-<span class="kw">getNeighborhoodInMask</span>(mnit, mask2, radius,</a>
<a class="sourceLine" id="cb42-7" data-line-number="7">  <span class="dt">physical.coordinates =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb42-8" data-line-number="8">  <span class="dt">boundary.condition =</span> <span class="st">"mean"</span> )</a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(mat2))</a></code></pre></div>
<pre><code>## [1]   25 1113</code></pre>
<p>The variable <code>mat2</code> has size determined by the neighborhood radius (here, 5) and the number of non-zero voxels in the mask. The <code>boundary.condition</code> says how to treat data that is outside of the mask or the image boundaries. This example replaces missing data with the mean in-mask value of the local neighborhood.</p>
<p>Other useful tools in ANTs<em>R</em> include <code>iMath</code>, <code>thresholdImage</code>, <code>quantifyCBF</code>, <code>preprocessfMRI</code>, <code>aslPerfusion</code>, <code>computeDVARS</code>, <code>getROIValues</code>, <code>hemodynamicRF</code>, <code>makeGraph</code>, <code>matrixToImages</code>, <code>rfSegmentation</code>, <code>antsRegistration</code>, <code>plotPrettyGraph</code>, <code>plotBasicNetwork</code>, <code>getTemplateCoordinates</code>, <code>antsSet*</code>.</p>
<p>Several image mathematics operations (like <code>ImageMath</code> in ANTs) are accessible too via <code>iMath</code>.</p>
</div>
<div id="example-label-sets-and-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-label-sets-and-data" class="anchor"></a>Example label sets and data</h2>
<p>ANTs<em>R</em> also provides AAL label <span class="citation">(Tzourio-Mazoyer et al. 2002)</span> names via:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(aal,<span class="dt">package=</span><span class="st">'ANTsR'</span>)</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">labs&lt;-<span class="dv">1</span><span class="op">:</span><span class="dv">90</span></a></code></pre></div>
<p>with cortical labs defined by <code>labs</code>. The DKT atlas labels are similarly summarized in <code>DesikanKillianyTourville</code> <span class="citation">(Klein and Tourville 2012)</span>.<br>
An example BOLD correlation matrix is available in <code>bold_correlation_matrix</code>. This can be used to try out <code>makeGraph</code> and related functions.</p>
</div>
<div id="visualization-and-plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-and-plotting" class="anchor"></a>Visualization and plotting</h2>
<p>The basic <code>plot</code> function is implemented for the <code>antsImage</code> class. It can show 2 or 3D data with color overlays, the latter of which can display multiple slices side by side. Several color choices are available for the overlays.</p>
<p>For 3D images, see <code>renderSurfaceFunction</code> and <code>plotBasicNetwork</code> for <code>rgl</code> and <code>misc3d</code> based interactive surface and network plots. Another such example is in <code>visualizeBlob</code>. These are too long-running to compile into the vignette but the help examples for these functions will allow you to see their results.</p>
<p>A good visualization alternative outside of ANTs<em>R</em> is <a href="https://github.com/stnava/antsSurf">antsSurf</a>.</p>
</div>
<div id="bold-data-processing-with-antsr" class="section level2">
<h2 class="hasAnchor">
<a href="#bold-data-processing-with-antsr" class="anchor"></a>BOLD data processing with ANTs<em>R</em>
</h2>
<p>Good approaches exist in ANTs<em>R</em> for preprocessing BOLD data. These yield both motion matrices and relevant summary measurements such as FD and DVARS. See <code><a href="../reference/preprocessfMRI.html">?preprocessfMRI</a></code> for a simplified utility function. This function could be used on each run of an experiment and the results stored in organized fashion for later use.</p>
<p><strong>Motion correction</strong></p>
<p>To motion correct your data, one might run:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co"># get an average image</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">averageImage &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getAverageOfTimeSeries.html">getAverageOfTimeSeries</a></span>( boldImage )</a>
<a class="sourceLine" id="cb45-3" data-line-number="3">motionCorrectionResults &lt;-<span class="st"> </span><span class="kw"><a href="../reference/antsMotionCalculation.html">antsMotionCalculation</a></span>( boldImage,</a>
<a class="sourceLine" id="cb45-4" data-line-number="4">   <span class="dt">fixed =</span> averageImage )</a></code></pre></div>
<p>A <code>moreaccurate</code> flag should be set to <code>1</code> or <code>2</code> for usable (not test) results. FD and DVARS are returned which may be used to summarize motion. One might also get this data from <code>preprocessfMRI</code> which also provides denoising options based on data-driven methods including frequency filtering.</p>
<p>For more fMRI focused tools, see <a href="http://stnava.github.io/RKRNS/">RKRNS</a> and its github site <a href="https://github.com/stnava/RKRNS">github RKRNS</a>.</p>
</div>
<div id="dimensionality-reduction" class="section level2">
<h2 class="hasAnchor">
<a href="#dimensionality-reduction" class="anchor"></a>Dimensionality reduction</h2>
<p>Images often have many voxels (<span class="math inline">\(p\)</span>-voxels) and, in medical applications, this means that <span class="math inline">\(p&gt;n\)</span> or even <span class="math inline">\(p&gt;&gt;n\)</span>, where <span class="math inline">\(n\)</span> is the number of subjects. Therefore, we often want to “intelligently” reduce the dimensionality of the data. We favor methods related to PCA and CCA but have a few ICA related tools too.</p>
<p><strong>Eigenanatomy &amp; SCCAN</strong></p>
<p>Our sparse and geometrically constrained dimensionality reduction methods seek to both explain variance and also yield interpretable, spatially localized pseudo-eigenvectors <span class="citation">(Kandel et al. 2014,<span class="citation">@Cook2014</span>)</span>. This is the point of “eigenanatomy” which is a variation of sparse PCA that uses (optionally) biologically-motivated smoothness, locality or sparsity constraints.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># assume you ran the population example above</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">eanat&lt;-<span class="kw"><a href="../reference/sparseDecom.html">sparseDecom</a></span>( mat, mask, <span class="fl">0.2</span>, <span class="dv">5</span>, <span class="dt">cthresh=</span><span class="dv">2</span>, <span class="dt">its=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">eanatimages =<span class="st"> </span><span class="kw">matrixToImages</span>( eanat<span class="op">$</span>eig, mask )</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">eseg&lt;-<span class="kw"><a href="../reference/eigSeg.html">eigSeg</a></span>(mask, eanatimages ,F)</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">jeanat&lt;-<span class="kw"><a href="../reference/joinEigenanatomy.html">joinEigenanatomy</a></span>(mat, mask, eanatimages, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.1</span>))</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">eseg2&lt;-<span class="kw"><a href="../reference/eigSeg.html">eigSeg</a></span>(mask,jeanat<span class="op">$</span>fusedlist,F)</a></code></pre></div>
<p>The parameters for the example above are set for fast processing. You can see our paper for some theory on these methods <span class="citation">(Kandel et al. 2014)</span>. A more realistic study setup would be</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">eanat&lt;-<span class="kw"><a href="../reference/sparseDecom.html">sparseDecom</a></span>( <span class="dt">inmatrix=</span>mat, <span class="dt">inmask=</span>famask, <span class="dt">nvecs=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">  <span class="dt">sparseness=</span><span class="fl">0.005</span>, <span class="dt">cthresh=</span><span class="dv">500</span>, <span class="dt">its=</span><span class="dv">5</span>, <span class="dt">mycoption=</span><span class="dv">0</span> )</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">jeanat&lt;-<span class="kw"><a href="../reference/joinEigenanatomy.html">joinEigenanatomy</a></span>( mat , famask, eanat<span class="op">$</span>eig,</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)<span class="op">/</span><span class="fl">100.0</span> , <span class="dt">joinMethod=</span><span class="st">'multilevel'</span> )</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">useeig&lt;-eanat<span class="op">$</span>eig</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">useeig&lt;-jeanat<span class="op">$</span>fusedlist</a>
<a class="sourceLine" id="cb47-7" data-line-number="7">avgmat&lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(<span class="kw">imageListToMatrix</span>( useeig , famask ))</a>
<a class="sourceLine" id="cb47-8" data-line-number="8">avgmat&lt;-avgmat<span class="op">/</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(avgmat))</a>
<a class="sourceLine" id="cb47-9" data-line-number="9">imgmat&lt;-(  mat <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(avgmat)  )</a></code></pre></div>
<p>The <code>imgmat</code> variable would be your summary predictors entered into <code>lm</code> or <code>randomForest</code>.</p>
<p>More information is available within the examples that can be seen within the help for <code>sparseDecom</code>, <code>sparseDecom2</code> and the helper function <code>initializeEigenanatomy</code>.</p>
<p><strong>Sparse canonical correlation analysis</strong></p>
<p>CCA maximizes <span class="math inline">\(PearsonCorrelation( XW^T, ZY^T )\)</span> where <span class="math inline">\(X, W\)</span> are as above and <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span> are similarly defined. CCA optimizes the matrices <span class="math inline">\(W, Y\)</span> operating on <span class="math inline">\(X, Z\)</span> to find a low-dimensional representation of the data pair <span class="math inline">\(( X , Z )\)</span> in which correlation is maximal. Following ideas outlined in <span class="citation">Dhillon et al. (2014)</span> and <span class="citation">B. B. Avants, Libon, et al. (2014)</span>, this method can be extended with sparsity constraints that yield rows of <span class="math inline">\(W, Y\)</span> with a controllable number of non-zero entries. See the <a href="http://stnava.github.io/sccanTutorial/">sccan tutorial</a> and <code>sparseDecom2</code> for more information.</p>
</div>
<div id="conclusions" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusions" class="anchor"></a>Conclusions</h2>
<p>With the current ANTs<em>R</em>, one may:</p>
<ul>
<li><p>Exploit ANTs and ITK functionality within <em>R</em></p></li>
<li><p>Leverage <em>R</em> functionality to help understand and interpret imaging data</p></li>
<li><p>Use feature selection based on various filtering strategies in <code>iMath</code> and elsewhere (e.g <code>segmentShapeFromImage</code>)</p></li>
<li><p>Employ dimensionality reduction through eigenanatomy or SCCAN with a variety of incarnations, some of which are similar to ICA</p></li>
<li><p>Use relatively few interpretable and low-dimensional predictors derived from high-dimensional data.</p></li>
<li><p>Interpret multivariate results intuitively when used in combination with standard <em>R</em> visualization.</p></li>
</ul>
<p>See <a href="https://github.com/stnava/ANTsR">ANTsR</a> for all source code and documentation and <a href="http://stnava.github.io/RKRNS">RKRNS-talk</a> for html slides that discuss extensions to BOLD decoding.</p>
<p>Enjoy and please refer issues to <a href="https://github.com/stnava/ANTsR/issues">ANTs<em>R</em> issues</a>.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Avants2015">
<p>Avants, Brian B. et al. 2015. “The Pediatric Template of Brain Perfusion.” <em>Sci. Data</em>.</p>
</div>
<div id="ref-Avants2014">
<p>Avants, Brian B., David J. Libon, Katya Rascovsky, Ashley Boller, Corey T. McMillan, Lauren Massimo, H Branch Coslett, Anjan Chatterjee, Rachel G. Gross, and Murray Grossman. 2014. “Sparse Canonical Correlation Analysis Relates Network-Level Atrophy to Multivariate Cognitive Measures in a Neurodegenerative Population.” <em>Neuroimage</em> 84 (January). Department of Radiology, University of Pennsylvania School of Medicine, Philadelphia, PA, USA.: 698–711. <a href="https://doi.org/10.1016/j.neuroimage.2013.09.048">https://doi.org/10.1016/j.neuroimage.2013.09.048</a>.</p>
</div>
<div id="ref-Avants2014a">
<p>Avants, Brian B., Nicholas J. Tustison, Michael Stauffer, Gang Song, Baohua Wu, and James C. Gee. 2014. “The Insight Toolkit Image Registration Framework.” <em>Front Neuroinform</em> 8. Penn Image Computing; Science Laboratory, Department of Radiology, University of Pennsylvania Philadelphia, PA, USA.: 44. <a href="https://doi.org/10.3389/fninf.2014.00044">https://doi.org/10.3389/fninf.2014.00044</a>.</p>
</div>
<div id="ref-Avants2011">
<p>Avants, Brian B., Nicholas J. Tustison, Jue Wu, Philip A. Cook, and James C. Gee. 2011. “An Open Source Multivariate Framework for N-Tissue Segmentation with Evaluation on Public Data.” <em>Neuroinformatics</em> 9 (4). Penn Image Computing; Science Laboratory, University of Pennsylvania, 3600 Market Street, Suite 370, Philadelphia, PA 19104, USA. stnava@gmail.com: 381–400. <a href="https://doi.org/10.1007/s12021-011-9109-y">https://doi.org/10.1007/s12021-011-9109-y</a>.</p>
</div>
<div id="ref-Avants2012">
<p>Avants, Brian, Paramveer Dhillon, Benjamin M. Kandel, Philip A. Cook, Corey T. McMillan, Murray Grossman, and James C. Gee. 2012. “Eigenanatomy Improves Detection Power for Longitudinal Cortical Change.” <em>Med Image Comput Comput Assist Interv</em> 15 (Pt 3). Department of Radiology, University of Pennsylvania, Philadelphia, PA 19104, USA.: 206–13.</p>
</div>
<div id="ref-Cook2014">
<p>Cook, Philip A., Corey T. McMillan, Brian B. Avants, Jonathan E. Peelle, James C. Gee, and Murray Grossman. 2014. “Relating Brain Anatomy and Cognitive Ability Using a Multivariate Multimodal Framework.” <em>Neuroimage</em>, May. Penn Frontotemporal Degeneration Center, Department of Neurology, Perelman School of Medicine, University of Pennsylvania, Philadelphia, PA 19104, USA. <a href="https://doi.org/10.1016/j.neuroimage.2014.05.008">https://doi.org/10.1016/j.neuroimage.2014.05.008</a>.</p>
</div>
<div id="ref-deMarvao2014">
<p>de Marvao, Antonio, Timothy J W. Dawes, Wenzhe Shi, Christopher Minas, Niall G. Keenan, Tamara Diamond, Giuliana Durighel, et al. 2014. “Population-Based Studies of Myocardial Hypertrophy: High Resolution Cardiovascular Magnetic Resonance Atlases Improve Statistical Power.” <em>J Cardiovasc Magn Reson</em> 16. th Hospital Campus, Du Cane Road, London W12 0NN, UK. antonio.de-marvao10@imperial.ac.uk.: 16. <a href="https://doi.org/10.1186/1532-429X-16-16">https://doi.org/10.1186/1532-429X-16-16</a>.</p>
</div>
<div id="ref-Dhillon2014">
<p>Dhillon, Paramveer S., David A. Wolk, Sandhitsu R. Das, Lyle H. Ungar, James C. Gee, and Brian B. Avants. 2014. “Subject-Specific Functional Parcellation via Prior Based Eigenanatomy.” <em>Neuroimage</em>, May. Penn Image Computing; Science Laboratory (PICSL), Department of Radiology, University of Pennsylvania, Philadelphia, PA, USA. <a href="https://doi.org/10.1016/j.neuroimage.2014.05.026">https://doi.org/10.1016/j.neuroimage.2014.05.026</a>.</p>
</div>
<div id="ref-dirksbook">
<p>Eddelbuettel, Dirk. 2013. <em>Seamless R and C++ Integration with Rcpp</em>. New York: Springer.</p>
</div>
<div id="ref-Johnson2010">
<p>Johnson, G Allan, Alexandra Badea, Jeffrey Brandenburg, Gary Cofer, Boma Fubara, Song Liu, and Jonathan Nissanov. 2010. “Waxholm Space: An Image-Based Reference for Coordinating Mouse Brain Research.” <em>Neuroimage</em> 53 (2). Duke Center for In Vivo Microscopy, Radiology, Duke University Medical Center, Durham, NC 27710, USA. gjohnson@duke.edu: 365–72. <a href="https://doi.org/10.1016/j.neuroimage.2010.06.067">https://doi.org/10.1016/j.neuroimage.2010.06.067</a>.</p>
</div>
<div id="ref-Kandel2015">
<p>Kandel, Benjamin M., Danny J J. Wang, John A. Detre, James C. Gee, and Brian B. Avants. 2015. “Decomposing Cerebral Blood Flow Mri into Functional and Structural Components: A Non-Local Approach Based on Prediction.” <em>Neuroimage</em> 105 (January). Penn Image Computing; Science Laboratory, University of Pennsylvania, Philadelphia, PA, USA; Department of Radiology, Hospital of the University of Pennsylvania, Philadelphia, PA, USA.: 156–70. <a href="https://doi.org/10.1016/j.neuroimage.2014.10.052">https://doi.org/10.1016/j.neuroimage.2014.10.052</a>.</p>
</div>
<div id="ref-Kandel2014a">
<p>Kandel, Benjamin M., Danny J J. Wang, James C. Gee, and Brian B. Avants. 2014. “Eigenanatomy: Sparse Dimensionality Reduction for Multi-Modal Medical Image Analysis.” <em>Methods</em>, October. Penn Image Computing; Science Laboratory, University of Pennsylvania, Philadelphia, PA, United States; Department of Radiology, Hospital of the University of Pennsylvania, Philadelphia, PA, United States. <a href="https://doi.org/10.1016/j.ymeth.2014.10.016">https://doi.org/10.1016/j.ymeth.2014.10.016</a>.</p>
</div>
<div id="ref-Kim2008">
<p>Kim, Junghoon, Brian Avants, Sunil Patel, John Whyte, Branch H. Coslett, John Pluta, John A. Detre, and James C. Gee. 2008. “Structural Consequences of Diffuse Traumatic Brain Injury: A Large Deformation Tensor-Based Morphometry Study.” <em>Neuroimage</em> 39 (3). Moss Rehabilitation Research Institute, Albert Einstein Healthcare Network, Philadelphia, PA 19141, USA. kimj@einstein.edu: 1014–26. <a href="https://doi.org/10.1016/j.neuroimage.2007.10.005">https://doi.org/10.1016/j.neuroimage.2007.10.005</a>.</p>
</div>
<div id="ref-Klein2012">
<p>Klein, Arno, and Jason Tourville. 2012. “101 Labeled Brain Images and a Consistent Human Cortical Labeling Protocol.” <em>Front Neurosci</em> 6. of Medicine Stony Brook, NY, USA ; Department of Psychiatry, Columbia University New York, NY, USA.: 171. <a href="https://doi.org/10.3389/fnins.2012.00171">https://doi.org/10.3389/fnins.2012.00171</a>.</p>
</div>
<div id="ref-Majka2013">
<p>Majka, Piotr, Jakub M. Kowalski, Natalia Chlodzinska, and Daniel K. Wójcik. 2013. “3D Brain Atlas Reconstructor Service–Online Repository of Three-Dimensional Models of Brain Structures.” <em>Neuroinformatics</em> 11 (4). Nencki Institute of Experimental Biology, 3 Pasteur Street, 02-093, Warsaw, Poland, p.majka@nencki.gov.pl.: 507–18. <a href="https://doi.org/10.1007/s12021-013-9199-9">https://doi.org/10.1007/s12021-013-9199-9</a>.</p>
</div>
<div id="ref-TALAIRACH1958">
<p>TALAIRACH, J., and P. TOURNOUX. 1958. “[Stereotaxic Localization of Central Gray Nuclei].” <em>Neurochirurgia (Stuttg)</em> 1 (1): 88–93. <a href="https://doi.org/10.1055/s-0028-1095515">https://doi.org/10.1055/s-0028-1095515</a>.</p>
</div>
<div id="ref-Tustison2013">
<p>Tustison, Nicholas J., and Brian B. Avants. 2013. “Explicit B-Spline Regularization in Diffeomorphic Image Registration.” <em>Front Neuroinform</em> 7. Penn Image Computing; Science Laboratory, Department of Radiology, University of Pennsylvania Philadelphia, PA, USA.: 39. <a href="https://doi.org/10.3389/fninf.2013.00039">https://doi.org/10.3389/fninf.2013.00039</a>.</p>
</div>
<div id="ref-Tustison2010">
<p>Tustison, Nicholas J., Brian B. Avants, Philip A. Cook, Yuanjie Zheng, Alexander Egan, Paul A. Yushkevich, and James C. Gee. 2010. “N4ITK: Improved N3 Bias Correction.” <em>IEEE Trans Med Imaging</em> 29 (6). Department of Radiology, University of Pennsylvania, Philadelphia, PA 19140, USA. ntustison@wustl.edu: 1310–20. <a href="https://doi.org/10.1109/TMI.2010.2046908">https://doi.org/10.1109/TMI.2010.2046908</a>.</p>
</div>
<div id="ref-Tustison2014">
<p>Tustison, Nicholas J., Philip A. Cook, Arno Klein, Gang Song, Sandhitsu R. Das, Jeffrey T. Duda, Benjamin M. Kandel, et al. 2014. “Large-Scale Evaluation of Ants and Freesurfer Cortical Thickness Measurements.” <em>Neuroimage</em> 99 (October). Penn Image Computing; Science Laboratory, University of Pennsylvania, Philadelphia, PA, USA.: 166–79. <a href="https://doi.org/10.1016/j.neuroimage.2014.05.044">https://doi.org/10.1016/j.neuroimage.2014.05.044</a>.</p>
</div>
<div id="ref-Tustison2014a">
<p>Tustison, Nicholas J., K. L. Shrinidhi, Max Wintermark, Christopher R. Durst, Benjamin M. Kandel, James C. Gee, Murray C. Grossman, and Brian B. Avants. 2014. “Optimal Symmetric Multimodal Templates and Concatenated Random Forests for Supervised Brain Tumor Segmentation (Simplified) with Antsr.” <em>Neuroinformatics</em>, November. Department of Radiology; Medical Imaging, University of Virginia, Charlottesville, VA, USA, ntustison@virginia.edu. <a href="https://doi.org/10.1007/s12021-014-9245-2">https://doi.org/10.1007/s12021-014-9245-2</a>.</p>
</div>
<div id="ref-Tzourio-Mazoyer2002">
<p>Tzourio-Mazoyer, N., B. Landeau, D. Papathanassiou, F. Crivello, O. Etard, N. Delcroix, B. Mazoyer, and M. Joliot. 2002. “Automated Anatomical Labeling of Activations in Spm Using a Macroscopic Anatomical Parcellation of the Mni Mri Single-Subject Brain.” <em>Neuroimage</em> 15 (1). Groupe d’Imagerie Neurofonctionnelle, UMR 6095 CNRS CEA, Université de Caen, Université de Paris 5, France.: 273–89. <a href="https://doi.org/10.1006/nimg.2001.0978">https://doi.org/10.1006/nimg.2001.0978</a>.</p>
</div>
<div id="ref-Wang2013a">
<p>Wang, Hongzhi, and Paul A. Yushkevich. 2013. “Multi-Atlas Segmentation with Joint Label Fusion and Corrective Learning-an Open Source Implementation.” <em>Front Neuroinform</em> 7. Department of Radiology, PICSL, Perelman School of Medicine at the University of Pennsylvania Philadelphia, PA, USA.: 27. <a href="https://doi.org/10.3389/fninf.2013.00027">https://doi.org/10.3389/fninf.2013.00027</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#antsr-algorithms">ANTs<em>R</em> Algorithms</a></li>
      <li><a href="#data-organization-and-access-in-antsr">Data organization and access in ANTs<em>R</em></a></li>
      <li><a href="#contributions-of-the-package">Contributions of the package</a></li>
      <li><a href="#basic-antsr-functionality">Basic ANTs<em>R</em> functionality</a></li>
      <li><a href="#more-antsr-functionality">More ANTs<em>R</em> functionality</a></li>
      <li><a href="#example-label-sets-and-data">Example label sets and data</a></li>
      <li><a href="#visualization-and-plotting">Visualization and plotting</a></li>
      <li><a href="#bold-data-processing-with-antsr">BOLD data processing with ANTs<em>R</em></a></li>
      <li><a href="#dimensionality-reduction">Dimensionality reduction</a></li>
      <li><a href="#conclusions">Conclusions</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brian B Avants.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
