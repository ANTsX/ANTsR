<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>joint label and intensity fusion — jointLabelFusion • ANTsR</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="joint label and intensity fusion — jointLabelFusion" />

<meta property="og:description" content="A multiple atlas voting scheme to customize labels for a new subject. This
function will also perform intensity fusion. It almost directly calls the
C++ in the ANTs executable so is much faster than other variants in ANTsR.
One may want to normalize image intensities for each input image before
passing to this function.  If no labels are passed, we do intensity fusion.
Note on computation time: the underlying C++
is multithreaded.  You can control the number of threads by setting the
environment variable ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS e.g. to use all or
some of your CPUs.  This will improve performance substantially. For instance,
on a macbook pro from 2015, 8 cores improves speed by about 4x." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ANTsR</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.7.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ANTsR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/MultiChannel.html">Multichannel image proccessing</a>
    </li>
    <li>
      <a href="../articles/RestingBOLD.html">Resting BOLD (basic analyses using ANTsR)</a>
    </li>
    <li>
      <a href="../articles/antsrTransform.html">Using the antsrTransform class</a>
    </li>
    <li>
      <a href="../articles/deformationSimulation.html">Simulate a deformation field with ANTsR</a>
    </li>
    <li>
      <a href="../articles/iMath.html">iMath (mathematical operations inside ANTsR)</a>
    </li>
    <li>
      <a href="../articles/multivarTemplateCoordinates.html">multivariate template coordinates example for eigenanatomy</a>
    </li>
    <li>
      <a href="../articles/rfLesionSeg.html">Multi-resolution voxel-wise neighborhood random forest (MRV-NRF) lesion segmentation</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>joint label and intensity fusion</h1>
    
    <div class="hidden name"><code>jointLabelFusion.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>A multiple atlas voting scheme to customize labels for a new subject. This
function will also perform intensity fusion. It almost directly calls the
<code>C++</code> in the ANTs executable so is much faster than other variants in ANTsR.
One may want to normalize image intensities for each input image before
passing to this function.  If no labels are passed, we do intensity fusion.
Note on computation time: the underlying <code>C++</code>
is multithreaded.  You can control the number of threads by setting the
environment variable <code>ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS</code> e.g. to use all or
some of your CPUs.  This will improve performance substantially. For instance,
on a macbook pro from 2015, 8 cores improves speed by about 4x.</p>
    
    </div>

    <pre class="usage"><span class='fu'>jointLabelFusion</span>(<span class='no'>targetI</span>, <span class='no'>targetIMask</span>, <span class='no'>atlasList</span>, <span class='kw'>beta</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>rad</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>labelList</span> <span class='kw'>=</span> <span class='fl'>NA</span>, <span class='kw'>rho</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>usecor</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>rSearch</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>nonnegative</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>targetI</th>
      <td><p>antsImage to be approximated</p></td>
    </tr>
    <tr>
      <th>targetIMask</th>
      <td><p>mask with value 1</p></td>
    </tr>
    <tr>
      <th>atlasList</th>
      <td><p>list containing antsImages with intensity images</p></td>
    </tr>
    <tr>
      <th>beta</th>
      <td><p>weight sharpness, default to 2</p></td>
    </tr>
    <tr>
      <th>rad</th>
      <td><p>neighborhood radius, default to 2</p></td>
    </tr>
    <tr>
      <th>labelList</th>
      <td><p>optional list containing antsImages with segmentation labels</p></td>
    </tr>
    <tr>
      <th>rho</th>
      <td><p>ridge penalty increases robustness to outliers but also
makes image converge to average</p></td>
    </tr>
    <tr>
      <th>usecor</th>
      <td><p>employ correlation as local similarity</p></td>
    </tr>
    <tr>
      <th>rSearch</th>
      <td><p>radius of search, default is 3</p></td>
    </tr>
    <tr>
      <th>nonnegative</th>
      <td><p>constrain weights to be non-negative</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>boolean</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>approximated image, segmentation and probabilities</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>set.seed</span>(<span class='fl'>123</span>)
<span class='no'>ref</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r16"</span>))
<span class='no'>ref</span><span class='kw'>&lt;-</span><span class='fu'>resampleImage</span>(<span class='no'>ref</span>,<span class='fu'>c</span>(<span class='fl'>50</span>,<span class='fl'>50</span>),<span class='fl'>1</span>,<span class='fl'>0</span>)
<span class='no'>ref</span><span class='kw'>&lt;-</span><span class='fu'>iMath</span>(<span class='no'>ref</span>,<span class='st'>"Normalize"</span>)
<span class='no'>mi</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r27"</span>))
<span class='no'>mi2</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r30"</span>))
<span class='no'>mi3</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r62"</span>))
<span class='no'>mi4</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r64"</span>))
<span class='no'>mi5</span><span class='kw'>&lt;-</span><span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"r85"</span>))
<span class='no'>refmask</span><span class='kw'>&lt;-</span><span class='fu'>getMask</span>(<span class='no'>ref</span>)
<span class='no'>refmask</span><span class='kw'>&lt;-</span><span class='fu'>iMath</span>(<span class='no'>refmask</span>,<span class='st'>"ME"</span>,<span class='fl'>2</span>) <span class='co'># just to speed things up</span>
<span class='no'>ilist</span><span class='kw'>&lt;-</span><span class='fu'>list</span>(<span class='no'>mi</span>,<span class='no'>mi2</span>,<span class='no'>mi3</span>,<span class='no'>mi4</span>,<span class='no'>mi5</span>)
<span class='no'>seglist</span><span class='kw'>&lt;-</span><span class='fu'>list</span>()
<span class='kw'>for</span> ( <span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fu'>length</span>(<span class='no'>ilist</span>) )
 {
 <span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]]<span class='kw'>&lt;-</span><span class='fu'>iMath</span>(<span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]],<span class='st'>"Normalize"</span>)
 <span class='no'>mytx</span><span class='kw'>&lt;-</span><span class='fu'>antsRegistration</span>(<span class='kw'>fixed</span><span class='kw'>=</span><span class='no'>ref</span> , <span class='kw'>moving</span><span class='kw'>=</span><span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]] ,
   <span class='kw'>typeofTransform</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"Affine"</span>) )
 <span class='no'>mywarpedimage</span><span class='kw'>&lt;-</span><span class='fu'>antsApplyTransforms</span>(<span class='kw'>fixed</span><span class='kw'>=</span><span class='no'>ref</span>,<span class='kw'>moving</span><span class='kw'>=</span><span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]],
   <span class='kw'>transformlist</span><span class='kw'>=</span><span class='no'>mytx</span>$<span class='no'>fwdtransforms</span>)
 <span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]]<span class='kw'>=</span><span class='no'>mywarpedimage</span>
 <span class='no'>seg</span><span class='kw'>&lt;-</span><span class='fu'>thresholdImage</span>( <span class='no'>ilist</span><span class='kw'>[[</span><span class='no'>i</span>]],<span class='st'>"Otsu"</span>, <span class='fl'>3</span>)
 <span class='no'>seglist</span><span class='kw'>[[</span><span class='no'>i</span>]]<span class='kw'>&lt;-</span><span class='no'>seg</span>
 }
<span class='no'>r</span><span class='kw'>&lt;-</span><span class='fl'>2</span>
<span class='no'>pp</span><span class='kw'>&lt;-</span><span class='fu'>jointLabelFusion</span>(<span class='no'>ref</span>,<span class='no'>refmask</span>,<span class='no'>ilist</span>, <span class='kw'>rSearch</span><span class='kw'>=</span><span class='fl'>2</span>,
  <span class='kw'>labelList</span><span class='kw'>=</span><span class='no'>seglist</span>, <span class='kw'>rad</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='no'>r</span>, <span class='fu'>length</span>(<span class='fu'>dim</span>(<span class='no'>ref</span>)) ) )
<span class='no'>pp</span><span class='kw'>&lt;-</span><span class='fu'>jointLabelFusion</span>(<span class='no'>ref</span>,<span class='no'>refmask</span>,<span class='no'>ilist</span>, <span class='kw'>rSearch</span><span class='kw'>=</span><span class='fl'>2</span>,
  <span class='kw'>rad</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='no'>r</span>, <span class='fu'>length</span>(<span class='fu'>dim</span>(<span class='no'>ref</span>)) ) )</div><span class='co'># NOT RUN {</span>
<span class='no'>ref</span> <span class='kw'>=</span> <span class='fu'>antsImageRead</span>( <span class='fu'>getANTsRData</span>(<span class='st'>"ch2"</span>) )
<span class='no'>n</span> <span class='kw'>=</span> <span class='fl'>50</span>
<span class='no'>ref</span> <span class='kw'>=</span> <span class='fu'>resampleImage</span>(<span class='no'>ref</span>,<span class='fu'>c</span>(<span class='no'>n</span>,<span class='no'>n</span>,<span class='no'>n</span>),<span class='fl'>1</span>,<span class='fl'>0</span>)
<span class='no'>ref</span> <span class='kw'>=</span> <span class='fu'>iMath</span>(<span class='no'>ref</span>,<span class='st'>"Normalize"</span>)
<span class='no'>refmask</span> <span class='kw'>=</span> <span class='fu'>getMask</span>(<span class='no'>ref</span>)
<span class='no'>ilist</span> <span class='kw'>=</span> <span class='fu'>list</span>()
<span class='no'>seglist</span> <span class='kw'>=</span> <span class='fu'>list</span>()
<span class='kw'>for</span> ( <span class='no'>k</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>5</span> ) {
<span class='no'>mi</span> <span class='kw'>=</span> <span class='fu'>antsImageClone</span>( <span class='no'>ref</span> ) + <span class='fu'>rnorm</span>( <span class='no'>n</span>^<span class='fl'>3</span>, <span class='fl'>0</span>, <span class='fl'>0.1</span> )
<span class='no'>mykseg</span> <span class='kw'>=</span> <span class='fu'>kmeansSegmentation</span>( <span class='no'>mi</span>, <span class='fl'>3</span>, <span class='no'>refmask</span> )$<span class='no'>segmentation</span>
<span class='no'>ilist</span><span class='kw'>[[</span> <span class='no'>k</span> ]] <span class='kw'>=</span> <span class='no'>mi</span>
<span class='no'>seglist</span><span class='kw'>[[</span> <span class='no'>k</span> ]] <span class='kw'>=</span> <span class='no'>mykseg</span>
}
<span class='no'>pp</span> <span class='kw'>=</span> <span class='fu'>jointLabelFusion</span>( <span class='no'>ref</span>, <span class='no'>refmask</span>,<span class='no'>ilist</span>, <span class='kw'>rSearch</span><span class='kw'>=</span><span class='fl'>2</span>,
 <span class='kw'>labelList</span><span class='kw'>=</span><span class='no'>seglist</span>, <span class='kw'>rad</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='fl'>2</span>, <span class='fu'>length</span>(<span class='fu'>dim</span>(<span class='no'>ref</span>)) ), <span class='kw'>verbose</span><span class='kw'>=</span><span class='fl'>TRUE</span> )
<span class='fu'>plot</span>( <span class='no'>ref</span>, <span class='no'>pp</span>$<span class='no'>segmentation</span> )
<span class='fu'>plot</span>( <span class='no'>pp</span>$<span class='no'>intensity</span>  )
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Brian B. Avants, Hongzhi Wang, Paul Yushkevich, Nicholas J. Tustison

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Brian B Avants.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

