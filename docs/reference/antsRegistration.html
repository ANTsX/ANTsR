<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform registration between two images. — antsRegistration • ANTsR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform registration between two images. — antsRegistration"><meta property="og:description" content="Register a pair of images either through the full or simplified interface
to the ANTs registration method."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ANTsR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/simlr_interpretation.html">SiMLR interpretation</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform registration between two images.</h1>
    
    <div class="hidden name"><code>antsRegistration.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Register a pair of images either through the full or simplified interface
to the ANTs registration method.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">antsRegistration</span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  moving <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  typeofTransform <span class="op">=</span> <span class="st">"SyN"</span>,</span>
<span>  initialTransform <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  outprefix <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  movingMask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maskAllStages <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  gradStep <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  flowSigma <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  totalSigma <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  affMetric <span class="op">=</span> <span class="st">"mattes"</span>,</span>
<span>  affSampling <span class="op">=</span> <span class="fl">32</span>,</span>
<span>  synMetric <span class="op">=</span> <span class="st">"mattes"</span>,</span>
<span>  synSampling <span class="op">=</span> <span class="fl">32</span>,</span>
<span>  <span class="va">affIterations</span>,</span>
<span>  regIterations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">20</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  <span class="va">multivariateExtras</span>,</span>
<span>  <span class="va">restrictTransformation</span>,</span>
<span>  writeCompositeTransform <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">randomSeed</span>,</span>
<span>  samplingPercentage <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  printArgs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>fixed</dt>
<dd><p>fixed image to which we register the moving image.</p></dd>


<dt>moving</dt>
<dd><p>moving image to be mapped to fixed space.</p></dd>


<dt>typeofTransform</dt>
<dd><p>A linear or non-linear registration type.  Mutual
information metric by default. See <code>Details.</code></p></dd>


<dt>initialTransform</dt>
<dd><p>either a single transform file name, a vector of transform file names,
or a single antsTransform object. If NA, an initial translation aligns the center of mass
of the moving image to that of the fixed image.</p></dd>


<dt>outprefix</dt>
<dd><p>output will be named with this prefix.</p></dd>


<dt>mask</dt>
<dd><p>Registration metric mask in the fixed image space.</p></dd>


<dt>movingMask</dt>
<dd><p>Registration metric mask in the moving image space.</p></dd>


<dt>maskAllStages</dt>
<dd><p>If true, apply metric mask(s) to all registration stages, instead of just the final stage.</p></dd>


<dt>gradStep</dt>
<dd><p>gradient step size (not for all tx)</p></dd>


<dt>flowSigma</dt>
<dd><p>smoothing for update field</p></dd>


<dt>totalSigma</dt>
<dd><p>smoothing for total field</p></dd>


<dt>affMetric</dt>
<dd><p>the metric for the affine part (GC, mattes, meansquares)</p></dd>


<dt>affSampling</dt>
<dd><p>the sampling parameter for the affine metric</p></dd>


<dt>synMetric</dt>
<dd><p>the metric for the syn part (CC, mattes, meansquares, demons)</p></dd>


<dt>synSampling</dt>
<dd><p>the nbins or radius parameter for the syn metric</p></dd>


<dt>affIterations</dt>
<dd><p>vector of iterations for low-dimensional registration.
we will set the smoothing and multi-resolution parameters based on the
length of this vector.</p></dd>


<dt>regIterations</dt>
<dd><p>vector of iterations for syn.  we will set the smoothing
and multi-resolution parameters based on the length of this vector.</p></dd>


<dt>multivariateExtras</dt>
<dd><p>list of additional images and metrics which will
trigger the use of multiple metrics in the registration process
in the deformable stage. Multivariate metrics needs 5 entries:
name of metric, fixed, moving, weight, samplingParam.
the list should be of the form
<code> list( list( "nameOfMetric2", img, img, weight, metricParam ) ) </code>.
Another example would be <code> list( list( "MeanSquares", f2, m2, 0.5, 0 ),
list( "CC", f2, m2, 0.5, 2 ) ) </code>.  This is only compatible with the
<code>SyNOnly</code>, <code>ElasticOnly</code>, or <code>antsRegistrationSyN*</code> transformations.</p></dd>


<dt>restrictTransformation</dt>
<dd><p>This option allows the user to restrict the
optimization of the displacement field, translation, rigid or affine
transform on a per-component basis. For example, if one wants to limit
the deformation or rotation of 3-D volume to the first two dimensions,
this is possible by specifying a weight vector of <code>c(1,1,0)</code> for a
3D deformation field or <code>c(1,1,0,1,1,0)</code> for a rigid transformation.
Restriction currently only works if there are no preceding transformations.</p></dd>


<dt>writeCompositeTransform</dt>
<dd><p>if <code>TRUE</code>, will write transformations to h5 format.  Defaults to FALSE.</p></dd>


<dt>randomSeed</dt>
<dd><p>integer random seed. combine with setting
ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS environment variable to limit the
impact of numerical differences.</p></dd>


<dt>samplingPercentage</dt>
<dd><p>value between zero and one that allows the percentage
of points sampled to be controlled in low-dimensional metric estimation.</p></dd>


<dt>verbose</dt>
<dd><p>request verbose output (useful for debugging)</p></dd>


<dt>printArgs</dt>
<dd><p>print raw command line (useful for debugging)</p></dd>


<dt>...</dt>
<dd><p>additional options see antsRegistration in ANTs</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>outputs a list containing:</p><ul><li><p>warpedmovout: Moving image warped to space of fixed image.</p></li>
<li><p>warpedfixout: Fixed image warped to space of moving image.</p></li>
<li><p>fwdtransforms: Transforms to move from moving to fixed image.</p></li>
<li><p>invtransforms: Transforms to move from fixed to moving image.</p></li>
</ul><p>Ouptut of 1 indicates failure</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>typeofTransform can be one of:</p><ul><li><p>"Translation": Translation transformation.</p></li>
<li><p>"Rigid": Rigid transformation: Only rotation and translation.</p></li>
<li><p>"Similarity": Similarity transformation: scaling, rotation and
  translation.</p></li>
<li><p>"QuickRigid": Rigid transformation: Only rotation and translation.
  May be useful for quick visualization fixes.'</p></li>
<li><p>"DenseRigid": Rigid transformation: Only rotation and translation.
  Employs dense sampling during metric estimation.'</p></li>
<li><p>"BOLDRigid": Rigid transformation: Parameters typical for BOLD
  to BOLD intrasubject registration'.'</p></li>
<li><p>"Affine": Affine transformation: Rigid + scaling.</p></li>
<li><p>"AffineFast": Fast version of <code>Affine</code>.</p></li>
<li><p>"BOLDAffine": Affine transformation: Parameters typical for BOLD
  to BOLD intrasubject registration'.'</p></li>
<li><p>"TRSAA": translation, rigid, similarity, affine (twice). please set
    <code>regIterations</code> if using this option.  this would be used in cases
    where you want a really high quality affine mapping (perhaps with mask).</p></li>
<li><p>"ElasticSyN": Symmetric normalization: Affine + deformable transformation.
    Uses <code>synMetric</code> as optimization metric and elastic regularization.</p></li>
<li><p>"SyN": Symmetric normalization: Affine + deformable transformation.
    Uses <code>synMetric</code> as optimization metric.</p></li>
<li><p>"SyNRA": Symmetric normalization: Rigid + Affine + deformable transformation.
    Uses <code>synMetric</code> as optimization metric.</p></li>
<li><p>"SyNOnly": Symmetric normalization: no initial transformation.
    Uses <code>synMetric</code> as optimization metric.  Assumes images are
    aligned by an inital transformation. Can be useful if you want to run
    an unmasked affine followed by masked deformable registration.</p></li>
<li><p>"ElasticOnly": Elastic normalization: no initial transformation.</p></li>
<li><p>"SyNCC": SyN, but with cross-correlation as the metric.
    Note, the default or chosen parameters will be replaced with
    <code>synMetric="CC", synSampling=4, synits="2100x1200x1200x20",
         smoothingsigmas="3x2x1x0", shrinkfactors="4x3x2x1"</code>.</p></li>
<li><p>"SyNabp": SyN optimized for abpBrainExtraction, forces mutual information
    as optimization metric.</p></li>
<li><p>"SyNBold": SyN, but optimized for registrations between
    BOLD and T1 images.</p></li>
<li><p>"SyNBoldAff": SyN, but optimized for registrations between
    BOLD and T1 images, with additional affine step.</p></li>
<li><p>"SyNAggro": SyN, but with more aggressive registration
    (fine-scale matching and more deformation).  Takes more time than <code>SyN</code>.</p></li>
<li><p>"TV[n]": time-varying diffeomorphism with where 'n' indicates number of
            time points in velocity field discretization.  The initial transform
            should be computed, if needed, in a separate call to ants.registration.</p></li>
<li><p>"TVMSQ": time-varying diffeomorphism with mean square metric</p></li>
<li><p>"TVMSQC": time-varying diffeomorphism with mean square metric
  for very large deformation</p></li>
<li><p>"Elastic": simple elastic deformation.  one might want to run an
  affine transformation before this.  may not produce diffeomorphic transformations.
  user may need to explore gradient and sigma parameters.  this will not produce a valid inverse deformation.  <code>totalSigma</code> should be greater than zero.</p></li>
<li><p>"antsRegistrationSyN[x]":recreation of the antsRegistrationSyN.sh script in ANTs
                                   where 'x' is one of the transforms available (e.g., 't', 'b', 's')</p></li>
<li><p>"antsRegistrationSyNQuick[x]":recreation of the antsRegistrationSyNQuick.sh script in ANTs
                                   where 'x' is one of the transforms available (e.g., 't', 'b', 's')</p></li>
<li><p>"antsRegistrationSyNRepro[x]":reproducible registration.  x options as above.</p></li>
<li><p>"antsRegistrationSyNQuickRepro[x]":quick reproducible registration.  x options as above.</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Shrinidhi KL, Tustison NJ, Avants BB</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># print help</span></span></span>
<span class="r-in"><span><span class="fu">antsRegistration</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> for simplified mode: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  antsRegistration( fixed , moving , typeofTransform = c("Rigid","Affine","AffineFast","SyN","SyNCC"),  outputPrefix="./antsRegOut" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For full mode: use standard ants call , e.g. : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ANTsR::antsRegistration( list( d=2,m="mi[r16slice.nii.gz,r64slice.nii.gz,1,20,Regular,0.05]", t="affine[1.0]", c="2100x1200x1200x0",  s="3x2x1x0", f="4x3x2x1", u="1", o="[xtest,xtest.nii.gz,xtest_inv.nii.gz]" ) )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> full help: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="va">fi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r16"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r64"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mytx2</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">fi</span>, typeofTransform <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> for simplified mode: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  antsRegistration( fixed , moving , typeofTransform = c("Rigid","Affine","AffineFast","SyN","SyNCC"),  outputPrefix="./antsRegOut" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For full mode: use standard ants call , e.g. : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ANTsR::antsRegistration( list( d=2,m="mi[r16slice.nii.gz,r64slice.nii.gz,1,20,Regular,0.05]", t="affine[1.0]", c="2100x1200x1200x0",  s="3x2x1x0", f="4x3x2x1", u="1", o="[xtest,xtest.nii.gz,xtest_inv.nii.gz]" ) )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> full help: </span>
<span class="r-in"><span><span class="va">rig</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  typeofTransform <span class="op">=</span> <span class="st">"Rigid"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="readAntsrTransform.html">readAntsrTransform</a></span><span class="op">(</span><span class="va">rig</span><span class="op">$</span><span class="va">fwdtransforms</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">postrig</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  typeofTransform <span class="op">=</span> <span class="st">"Affine"</span>, initialTransform <span class="op">=</span> <span class="va">trans</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">itype</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AffineFast"</span>, <span class="st">"BOLDAffine"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">itype</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">mytx2</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>    fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>    typeofTransform <span class="op">=</span> <span class="va">itype</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "AffineFast"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "BOLDAffine"</span>
<span class="r-in"><span><span class="va">mytx2</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  typeofTransform <span class="op">=</span> <span class="st">"SyNOnly"</span>,</span></span>
<span class="r-in"><span>  multivariateExtras <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"MeanSquares"</span>, <span class="va">fi</span>, <span class="va">mi</span>, <span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_error.html" class="external-link">expect_error</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu">antsRegistration</span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>, typeofTransform <span class="op">=</span> <span class="st">"sdf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bad</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>, regIterations <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">affIterations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mytx2</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  affIterations <span class="op">=</span> <span class="va">affIterations</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># set below for slower but numerically repeatable results</span></span></span>
<span class="r-in"><span><span class="co"># these should be set in .Renviron not by sys calls</span></span></span>
<span class="r-in"><span><span class="co">#  Sys.setenv(ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS = 1)</span></span></span>
<span class="r-in"><span><span class="co">#  Sys.setenv(ANTS_RANDOM_SEED = 20180716)</span></span></span>
<span class="r-in"><span><span class="va">fi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r16"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r64"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fi</span> <span class="op">&lt;-</span> <span class="fu"><a href="resampleImage.html">resampleImage</a></span><span class="op">(</span><span class="va">fi</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="resampleImage.html">resampleImage</a></span><span class="op">(</span><span class="va">mi</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># speed up</span></span></span>
<span class="r-in"><span><span class="va">mytx</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>, typeofTransform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SyN"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mywarpedimage</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsApplyTransforms.html">antsApplyTransforms</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  transformlist <span class="op">=</span> <span class="va">mytx</span><span class="op">$</span><span class="va">fwdtransforms</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mytx2</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>, typeofTransform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SyN"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mywarpedimage2</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsApplyTransforms.html">antsApplyTransforms</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>,</span></span>
<span class="r-in"><span>  transformlist <span class="op">=</span> <span class="va">mytx2</span><span class="op">$</span><span class="va">fwdtransforms</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># testthat::expect_equal(as.array(mywarpedimage), as.array(mywarpedimage2))</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># quick visualization fix for images with odd orientation</span></span></span>
<span class="r-in"><span><span class="va">mni</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"mni"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">strokt1</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="st">"strokt1.nii.gz"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">strokt1reg</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">mni</span>,</span></span>
<span class="r-in"><span>  moving <span class="op">=</span> <span class="va">strokt1</span>,</span></span>
<span class="r-in"><span>  typeofTransform <span class="op">=</span> <span class="st">"QuickRigid"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">strokt1reg</span><span class="op">$</span><span class="va">warpedmovout</span>, axis <span class="op">=</span> <span class="fl">3</span>, nslices <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># now - how to use a mask</span></span></span>
<span class="r-in"><span><span class="va">fi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r16"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fiseg</span> <span class="op">&lt;-</span> <span class="fu"><a href="kmeansSegmentation.html">kmeansSegmentation</a></span><span class="op">(</span><span class="va">fi</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mi</span> <span class="op">&lt;-</span> <span class="fu"><a href="antsImageRead.html">antsImageRead</a></span><span class="op">(</span><span class="fu"><a href="getANTsRData.html">getANTsRData</a></span><span class="op">(</span><span class="st">"r64"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">msk</span> <span class="op">&lt;-</span> <span class="fu"><a href="thresholdImage.html">thresholdImage</a></span><span class="op">(</span><span class="va">fiseg</span><span class="op">$</span><span class="va">segmentation</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mytx</span> <span class="op">&lt;-</span> <span class="fu">antsRegistration</span><span class="op">(</span></span></span>
<span class="r-in"><span>  fixed <span class="op">=</span> <span class="va">fi</span>, moving <span class="op">=</span> <span class="va">mi</span>, typeofTransform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SyNCC"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  mask <span class="op">=</span> <span class="va">msk</span>, verbose <span class="op">=</span> <span class="cn">F</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">jac</span> <span class="op">&lt;-</span> <span class="fu"><a href="createJacobianDeterminantImage.html">createJacobianDeterminantImage</a></span><span class="op">(</span><span class="va">fi</span>, <span class="va">mytx</span><span class="op">$</span><span class="va">fwdtransforms</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Brian B Avants.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

