#!/bin/bash
# retrieve Rcpp and R include and link directories
# R_DIR=(set by the user from command line)
RCPP_INCLUDE_DIR=`${R_DIR}Rscript -e 'Rcpp:::CxxFlags()'`
RCPP_LIB_DIR=`${R_DIR}Rscript -e 'Rcpp:::LdFlags()'`
R_INCLUDE_DIR=`${R_DIR}R CMD config --cppflags`
R_LIB_DIR=`${R_DIR}R CMD config --ldflags`
cd ./src
cmake  -D ANTS_DIR:PATH="$ANTS_DIR" -D ITK_DIR:PATH="$ITK_DIR" -D RCPP_INCLUDE_DIR:PATH="$RCPP_INCLUDE_DIR" -D RCPP_LIB_DIR:PATH="$RCPP_LIB_DIR" -D R_INCLUDE_DIR:PATH="$R_INCLUDE_DIR" -D R_LIB_DIR:PATH="$R_LIB_DIR" -D CMAKE_BUILD_TYPE:STRING="${CMAKE_BUILD_TYPE}"  .
make -j 2 # $ITK_GLOBAL_DEFAULT_NUMBER_OF_THREADS 
rm Makefile
RLDPATH=${PWD}/ANTS/ANTS-build/lib/
if [[ ${#R_LIBS_USER} -gt 0 ]] ; then 
  echo DO THE COPYING 
  RLDPATH=`echo $R_LIBS_USER | cut -d ':' -f 1`ANTsR/libs/
  mkdir -p $RLDPATH
  cp ${PWD}/ANTS/ANTS-build/lib/lib*.a $RLDPATH
fi 
